import math
import matplotlib.pyplot as plt

def calculate_basic_clothoid(s_length):
    clothoid_points = []
    dt = 0.001  # Step size for numerical integration
    t = 0.0

    while t <= s_length:
        x = t * math.cos(t * t / 2)
        y = t * math.sin(t * t / 2)
        clothoid_points.append((x, y))
        t += dt

    return clothoid_points

def reflect_point_across_normal(point, merging_point):
    x, y = point
    x_merge, y_merge = merging_point
    bias = -0.8
    tangent_angle = bias + math.atan2( y_merge, -x_merge)
    normal_x = math.sin(tangent_angle)
    normal_y = math.cos(tangent_angle)

    dx = x - x_merge
    dy = y - y_merge

    # Calculate the dot product of the vector and the normal
    dot_product = dx * normal_x + dy * normal_y

    # Project the vector onto the normal
    projected_x = dot_product * normal_x
    projected_y = dot_product * normal_y
    
    origin_ref_x = projected_x + (projected_x - dx)
    origin_ref_y = projected_y + (projected_y - dy)
    
    reflected_x = origin_ref_x + x_merge
    reflected_y = origin_ref_y + y_merge
    return reflected_x, reflected_y

def symmetric_clothoid(first_clothoid_points):
    merging_point = first_clothoid_points[-1]

    symmetric_clothoid_points = [reflect_point_across_normal(point, merging_point)
                                 for point in reversed(first_clothoid_points)]

    merged_clothoid_points = symmetric_clothoid_points

    return merged_clothoid_points

# Define the length of the clothoid
s_length = 1

# Calculate the basic and symmetric clothoid points
basic_clothoid_points = calculate_basic_clothoid(s_length)

symmetric_clothoid_points = symmetric_clothoid(basic_clothoid_points)

# Extract x and y coordinates for plotting
basic_clothoid_x, basic_clothoid_y = zip(*basic_clothoid_points)
symmetric_clothoid_x, symmetric_clothoid_y = zip(*symmetric_clothoid_points)

# Plot the clothoids
plt.figure(figsize=(8, 6))
plt.plot(basic_clothoid_x, basic_clothoid_y, label="Basic Clothoid")
plt.plot(symmetric_clothoid_x, symmetric_clothoid_y, label="Symmetric Clothoid")
plt.xlabel("x")
plt.ylabel("y")
plt.title("Clothoid and Symmetric Clothoid")
plt.legend()
plt.grid(True)
plt.axis("equal")
plt.show()